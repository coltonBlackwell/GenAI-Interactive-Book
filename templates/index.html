<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Story Creator</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="container">
    <div class="decoration star1">â˜…</div>
    <div class="decoration star2">âœ¦</div>
    <div class="decoration star3">âœ§</div>
    <div class="decoration star4">âœ¶</div>
    
    <h1>âœ¨ AI Storytime Generator âœ¨</h1>
    <p>Pick any combination of items to create your magical story! (Select at least 1)</p>

    <h3>ğŸ¾ Choose Characters/Items:</h3>
    <div id="animal-buttons">
      <button onclick="selectItem(this)">ğŸ± Cat</button>
      <button onclick="selectItem(this)">ğŸ¶ Dog</button>
      <button onclick="selectItem(this)">ğŸ˜ Elephant</button>
      <button onclick="selectItem(this)">ğŸ¦Š Fox</button>
      <button onclick="selectItem(this)">ğŸ» Bear</button>
      <button onclick="selectItem(this)">ğŸ¦‰ Owl</button>
      <button onclick="selectItem(this)">ğŸ¦ Lion</button>
      <button onclick="selectItem(this)">ğŸ§ Penguin</button>
      <button onclick="selectItem(this)">ğŸ° Rabbit</button>
      <button onclick="selectItem(this)">ğŸ¦˜ Kangaroo</button>
    </div>

    <h3>ğŸ Choose Characters/Items:</h3>
    <div id="object-buttons">
      <button onclick="selectItem(this)">âš½ Ball</button>
      <button onclick="selectItem(this)">ğŸ§¢ Hat</button>
      <button onclick="selectItem(this)">ğŸ“š Book</button>
      <button onclick="selectItem(this)">ğŸ’ Backpack</button>
      <button onclick="selectItem(this)">ğŸ‘“ Glasses</button>
      <button onclick="selectItem(this)">ğŸ‘Ÿ Shoe</button>
      <button onclick="selectItem(this)">ğŸ“· Camera</button>
      <button onclick="selectItem(this)">ğŸ® Lantern</button>
      <button onclick="selectItem(this)">ğŸ—ºï¸ Map</button>
      <button onclick="selectItem(this)">â˜‚ï¸ Umbrella</button>
    </div>

    <div class="selection-counter" id="selectionCounter">0 items selected</div>
    <button id="generateBtn" onclick="generateStory()" disabled>ğŸª Create My Story! ğŸª</button>

    <div class="story-content">
      <img id="storyImage" width="512" height="512" style="display:none;">
      <audio id="storyAudio" controls style="display:none;"></audio>
      <div id="story">Your magical story will appear here!</div>
    </div>
  </div>

  <script>
    let selectedItems = [];

    function selectItem(button) {
      button.classList.toggle("selected");
      
      const itemText = button.innerText.replace(/[^a-zA-Z]/g, '');
      
      if (button.classList.contains("selected")) {
        selectedItems.push(itemText);
      } else {
        selectedItems = selectedItems.filter(item => item !== itemText);
      }
      
      document.getElementById("selectionCounter").textContent = 
        `${selectedItems.length} item${selectedItems.length !== 1 ? 's' : ''} selected`;
      
      document.getElementById("generateBtn").disabled = selectedItems.length === 0;
    }

    async function generateStory() {
      if (selectedItems.length === 0) {
        alert("Please select at least 1 item to create a story!");
        return;
      }

      document.getElementById("story").innerHTML = 
        `<div style='color:#ff8c42; font-size:1.5em;'>
          âœ¨ Creating your magical story with ${selectedItems.join(', ')}... âœ¨
          <br><span style='font-size:0.7em;'>Please wait while the fairies work their magic!</span>
        </div>`;
      document.getElementById("storyImage").style.display = "none";
      document.getElementById("storyAudio").style.display = "none";

      try {
        const response = await fetch("/generate", {
          method: "POST",
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ items: selectedItems })
        });

        const data = await response.json();

        document.getElementById("story").innerText = data.story;
        document.getElementById("storyImage").src = data.image_url;
        document.getElementById("storyImage").style.display = "block";
        document.getElementById("storyAudio").src = data.audio_url;
        document.getElementById("storyAudio").style.display = "block";
      } catch (error) {
        document.getElementById("story").innerHTML = 
          `<div style='color:#ff6b9d;'>
            Oh no! The story machine took a nap!<br>
            Please try again later.
          </div>`;
      }
    }
  </script>
</body>
</html>